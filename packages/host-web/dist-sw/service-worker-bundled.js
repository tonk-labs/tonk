const ut="modulepreload",lt=function(n){return"/"+n},H={},$=function(t,e,r){let o=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");o=Promise.allSettled(e.map(b=>{if(b=lt(b),b in H)return;H[b]=!0;const A=b.endsWith(".css"),O=A?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${O}`))return;const S=document.createElement("link");if(S.rel=A?"stylesheet":ut,A||(S.as="script"),S.crossOrigin="",S.href=b,a&&S.setAttribute("nonce",a),document.head.appendChild(S),A)return new Promise((at,_t)=>{S.addEventListener("load",at),S.addEventListener("error",()=>_t(new Error(`Unable to preload CSS for ${b}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})};var ot=function(n,t,e,r,o){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?n!==t||!o:!t.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?o.call(n,e):o?o.value=e:t.set(n,e),e},w=function(n,t,e,r){if(e==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?n!==t||!r:!t.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?r:e==="a"?r.call(n):r?r.value:t.get(n)},F,g;class z extends Error{constructor(t,e){super(t),this.code=e,this.name="TonkError"}}class ft extends z{constructor(t){super(t,"CONNECTION_ERROR"),this.name="ConnectionError"}}class y extends z{constructor(t){super(t,"FILESYSTEM_ERROR"),this.name="FileSystemError"}}class I extends z{constructor(t){super(t,"BUNDLE_ERROR"),this.name="BundleError"}}class K{constructor(t){F.set(this,void 0),ot(this,F,t,"f")}static async fromBytes(t,e){try{const{create_bundle_from_bytes:r}=e||await $(()=>Promise.resolve().then(()=>j),void 0);return new K(r(t))}catch(r){throw new I(`Failed to create bundle from bytes: ${r}`)}}async getRootId(){try{return await w(this,F,"f").getRootId()}catch(t){throw new I(`Failed to get root ID: ${t}`)}}async get(t){try{const e=await w(this,F,"f").get(t);return e===null?null:e}catch(e){throw new I(`Failed to get key ${t}: ${e}`)}}async getPrefix(t){try{return(await w(this,F,"f").getPrefix(t)).map(r=>({key:r.key,value:r.value}))}catch(e){throw new I(`Failed to get prefix ${t}: ${e}`)}}async listKeys(){try{return await w(this,F,"f").listKeys()}catch(t){throw new I(`Failed to list keys: ${t}`)}}async getManifest(){try{return await w(this,F,"f").getManifest()}catch(t){throw new I(`Failed to retrive manifest: ${t}`)}}async setManifest(t){try{await w(this,F,"f").setManifest(t)}catch(e){throw new I(`Failed to set manifest: ${e}`)}}async toBytes(){try{return await w(this,F,"f").toBytes()}catch(t){throw new I(`Failed to serialize bundle: ${t}`)}}free(){w(this,F,"f").free()}}F=new WeakMap;class E{constructor(t){g.set(this,void 0),ot(this,g,t,"f")}static async create(t,e){const r=e||await $(()=>Promise.resolve().then(()=>j),void 0);if(t?.peerId&&t?.storage){const{create_tonk_with_config:o}=r,i=await o(t.peerId,t.storage.type==="indexeddb");return new E(i)}else if(t?.peerId){const{create_tonk_with_peer_id:o}=r,i=await o(t.peerId);return new E(i)}else if(t?.storage){const{create_tonk_with_storage:o}=r,i=await o(t.storage.type==="indexeddb");return new E(i)}else{const{create_tonk:o}=r,i=await o();return new E(i)}}static async createWithPeerId(t,e){const{create_tonk_with_peer_id:r}=e||await $(()=>Promise.resolve().then(()=>j),void 0),o=await r(t);return new E(o)}static async fromBundle(t,e,r){const o=r||await $(()=>Promise.resolve().then(()=>j),void 0);if(e?.storage){const{create_tonk_from_bundle_with_storage:i}=o,s=await i(t,e.storage.type==="indexeddb");return new E(s)}else{const{create_tonk_from_bundle:i}=o,s=await i(t);return new E(s)}}static async fromBytes(t,e,r){const o=r||await $(()=>Promise.resolve().then(()=>j),void 0);if(e?.storage){const{create_tonk_from_bytes_with_storage:i}=o,s=await i(t,e.storage.type==="indexeddb");return new E(s)}else{const{create_tonk_from_bytes:i}=o,s=await i(t);return new E(s)}}getPeerId(){return w(this,g,"f").getPeerId()}async connectWebsocket(t){try{await w(this,g,"f").connectWebsocket(t)}catch(e){throw new ft(`Failed to connect to ${t}: ${e}`)}}async toBytes(t){try{return await w(this,g,"f").toBytes(t)}catch(e){throw new z(`Failed to serialize to bundle data: ${e}`)}}async createFile(t,e){try{await w(this,g,"f").createFile(t,e)}catch(r){throw new y(`Failed to create file at ${t}: ${r}`)}}async createFileWithBytes(t,e,r){try{let o=typeof r=="string"?Y(r):r;await w(this,g,"f").createFileWithBytes(t,e,o)}catch(o){throw new y(`Failed to create file at ${t}: ${o}`)}}async readFile(t){try{const e=await w(this,g,"f").readFile(t);if(console.log("IVE READ THE INTERMEDIARY!!!!!!!!!"),e===null)throw new y(`File not found: ${t}`);let r;if(e.bytes)if(typeof e.bytes=="string")r=e.bytes;else if(Array.isArray(e.bytes)){let i="";for(let s=0;s<e.bytes.length;s+=8192){const a=e.bytes.slice(s,s+8192);i+=String.fromCharCode(...a)}r=btoa(i)}else throw new y(`Unrecognized bytes type in readFile ${typeof e.bytes}`);return{...e,content:JSON.parse(e.content),bytes:r}}catch(e){throw e instanceof y?e:new y(`Failed to read file at ${t}: ${e}`)}}async updateFile(t,e){try{return await w(this,g,"f").updateFile(t,e)}catch(r){throw new y(`Failed to update file at ${t}: ${r}`)}}async updateFileWithBytes(t,e,r){try{let o=typeof r=="string"?Y(r):r;return await w(this,g,"f").updateFileWithBytes(t,e,o)}catch(o){throw new y(`Failed to update file at ${t}: ${o}`)}}async deleteFile(t){try{return await w(this,g,"f").deleteFile(t)}catch(e){throw new y(`Failed to delete file at ${t}: ${e}`)}}async createDirectory(t){try{await w(this,g,"f").createDirectory(t)}catch(e){throw new y(`Failed to create directory at ${t}: ${e}`)}}async listDirectory(t){try{return(await w(this,g,"f").listDirectory(t)).map(r=>({name:r.name,type:r.type}))}catch(e){throw new y(`Failed to list directory at ${t}: ${e}`)}}async exists(t){try{return await w(this,g,"f").exists(t)}catch(e){throw new y(`Failed to check existence of ${t}: ${e}`)}}async getMetadata(t){try{const e=await w(this,g,"f").getMetadata(t);return e===null?null:{nodeType:e.node_type,createdAt:new Date(e.created_at*1e3),modifiedAt:new Date(e.modified_at*1e3)}}catch(e){throw new y(`Failed to get metadata for ${t}: ${e}`)}}async watchFile(t,e){try{const r=await w(this,g,"f").watchDocument(t,e);return r===null?null:r}catch(r){throw new y(`Failed to watch file at path ${t}: ${r}`)}}async watchDirectory(t,e){try{const r=await w(this,g,"f").watchDirectory(t,e);return r===null?null:r}catch(r){throw new y(`Failed to watch directory at path ${t}: ${r}`)}}free(){w(this,g,"f").free()}}g=new WeakMap;const Y=n=>{const t=atob(n),e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e};let c,l=0,M=null;function W(){return(M===null||M.byteLength===0)&&(M=new Uint8Array(c.memory.buffer)),M}const L=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},wt=typeof L.encodeInto=="function"?function(n,t){return L.encodeInto(n,t)}:function(n,t){const e=L.encode(n);return t.set(e),{read:n.length,written:e.length}};function f(n,t,e){if(e===void 0){const a=L.encode(n),b=t(a.length,1)>>>0;return W().subarray(b,b+a.length).set(a),l=a.length,b}let r=n.length,o=t(r,1)>>>0;const i=W();let s=0;for(;s<r;s++){const a=n.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==r){s!==0&&(n=n.slice(s)),o=e(o,r,r=s+n.length*3,1)>>>0;const a=W().subarray(o+s,o+r),b=wt(n,a);s+=b.written,o=e(o,r,s,1)>>>0}return l=s,o}let B=null;function d(){return(B===null||B.buffer.detached===!0||B.buffer.detached===void 0&&B.buffer!==c.memory.buffer)&&(B=new DataView(c.memory.buffer)),B}function k(n){const t=c.__externref_table_alloc();return c.__wbindgen_export_4.set(t,n),t}function u(n,t){try{return n.apply(this,t)}catch(e){const r=k(e);c.__wbindgen_exn_store(r)}}const ct=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ct.decode();function m(n,t){return n=n>>>0,ct.decode(W().subarray(n,n+t))}function p(n){return n==null}function Q(n,t){return n=n>>>0,W().subarray(n/1,n/1+t)}const X=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>{c.__wbindgen_export_6.get(n.dtor)(n.a,n.b)});function x(n,t,e,r){const o={a:n,b:t,cnt:1,dtor:e},i=(...s)=>{o.cnt++;const a=o.a;o.a=0;try{return r(a,o.b,...s)}finally{--o.cnt===0?(c.__wbindgen_export_6.get(o.dtor)(a,o.b),X.unregister(o)):o.a=a}};return i.original=o,X.register(i,o,o),i}function q(n){const t=typeof n;if(t=="number"||t=="boolean"||n==null)return`${n}`;if(t=="string")return`"${n}"`;if(t=="symbol"){const o=n.description;return o==null?"Symbol":`Symbol(${o})`}if(t=="function"){const o=n.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(n)){const o=n.length;let i="[";o>0&&(i+=q(n[0]));for(let s=1;s<o;s++)i+=", "+q(n[s]);return i+="]",i}const e=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(e&&e.length>1)r=e[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function G(n){const t=c.__wbindgen_export_4.get(n);return c.__externref_table_dealloc(n),t}function J(n,t){if(!(n instanceof t))throw new Error(`expected instance of ${t.name}`)}function Z(n,t){const e=t(n.length*1,1)>>>0;return W().set(n,e/1),l=n.length,e}function bt(n){const t=f(n,c.__wbindgen_malloc,c.__wbindgen_realloc),e=l;return c.create_tonk_with_peer_id(t,e)}function dt(n){const t=c.create_bundle_from_bytes(n);if(t[2])throw G(t[1]);return D.__wrap(t[0])}function gt(n){return J(n,D),c.create_tonk_from_bundle(n.__wbg_ptr)}function ht(){c.init()}function yt(n,t){return c.create_tonk_from_bytes_with_storage(n,t)}function pt(n,t){const e=f(n,c.__wbindgen_malloc,c.__wbindgen_realloc),r=l;return c.create_tonk_with_config(e,r,t)}function mt(n,t){return J(n,D),c.create_tonk_from_bundle_with_storage(n.__wbg_ptr,t)}function Ft(n){return c.create_tonk_from_bytes(n)}function Et(n){return c.create_tonk_with_storage(n)}function kt(){return c.create_tonk()}function St(n){c.set_time_provider(n)}function V(n,t,e){c.closure472_externref_shim(n,t,e)}function It(n,t,e){const r=c.closure478_externref_shim_multivalue_shim(n,t,e);if(r[1])throw G(r[0])}function Rt(n,t,e){c.closure759_externref_shim(n,t,e)}function Dt(n,t){c._dyn_core__ops__function__FnMut_____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__hdefb2702ebaf554a(n,t)}function xt(n,t,e){c.closure776_externref_shim(n,t,e)}function Bt(n,t,e,r){c.closure1075_externref_shim(n,t,e,r)}const vt=["blob","arraybuffer"],Wt=["pending","done"],At=["readonly","readwrite","versionchange","readwriteflush","cleanup"],tt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_wasmbundle_free(n>>>0,1));class D{static __wrap(t){t=t>>>0;const e=Object.create(D.prototype);return e.__wbg_ptr=t,tt.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,tt.unregister(this),t}free(){const t=this.__destroy_into_raw();c.__wbg_wasmbundle_free(t,0)}static fromBytes(t){const e=c.wasmbundle_fromBytes(t);if(e[2])throw G(e[1]);return D.__wrap(e[0])}getPrefix(t){const e=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),r=l;return c.wasmbundle_getPrefix(this.__wbg_ptr,e,r)}getRootId(){return c.wasmbundle_getRootId(this.__wbg_ptr)}getManifest(){return c.wasmbundle_getManifest(this.__wbg_ptr)}setManifest(t){return c.wasmbundle_setManifest(this.__wbg_ptr,t)}get(t){const e=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),r=l;return c.wasmbundle_get(this.__wbg_ptr,e,r)}toBytes(){return c.wasmbundle_toBytes(this.__wbg_ptr)}listKeys(){return c.wasmbundle_listKeys(this.__wbg_ptr)}}const et=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_wasmdocumentwatcher_free(n>>>0,1));class U{static __wrap(t){t=t>>>0;const e=Object.create(U.prototype);return e.__wbg_ptr=t,et.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,et.unregister(this),t}free(){const t=this.__destroy_into_raw();c.__wbg_wasmdocumentwatcher_free(t,0)}documentId(){let t,e;try{const r=c.wasmdocumentwatcher_documentId(this.__wbg_ptr);return t=r[0],e=r[1],m(r[0],r[1])}finally{c.__wbindgen_free(t,e,1)}}stop(){return c.wasmdocumentwatcher_stop(this.__wbg_ptr)}}const nt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_wasmtonkcore_free(n>>>0,1));class N{static __wrap(t){t=t>>>0;const e=Object.create(N.prototype);return e.__wbg_ptr=t,nt.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,nt.unregister(this),t}free(){const t=this.__destroy_into_raw();c.__wbg_wasmtonkcore_free(t,0)}static fromBytes(t){return c.wasmtonkcore_fromBytes(t)}createFile(t,e){const r=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),o=l;return c.wasmtonkcore_createFile(this.__wbg_ptr,r,o,e)}deleteFile(t){const e=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),r=l;return c.wasmtonkcore_deleteFile(this.__wbg_ptr,e,r)}static fromBundle(t){return J(t,D),c.wasmtonkcore_fromBundle(t.__wbg_ptr)}getPeerId(){return c.wasmtonkcore_getPeerId(this.__wbg_ptr)}updateFile(t,e){const r=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),o=l;return c.wasmtonkcore_updateFile(this.__wbg_ptr,r,o,e)}getMetadata(t){const e=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),r=l;return c.wasmtonkcore_getMetadata(this.__wbg_ptr,e,r)}static withPeerId(t){const e=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),r=l;return c.wasmtonkcore_withPeerId(e,r)}listDirectory(t){const e=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),r=l;return c.wasmtonkcore_listDirectory(this.__wbg_ptr,e,r)}watchDocument(t,e){const r=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),o=l;return c.wasmtonkcore_watchDocument(this.__wbg_ptr,r,o,e)}watchDirectory(t,e){const r=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),o=l;return c.wasmtonkcore_watchDirectory(this.__wbg_ptr,r,o,e)}createDirectory(t){const e=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),r=l;return c.wasmtonkcore_createDirectory(this.__wbg_ptr,e,r)}connectWebsocket(t){const e=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),r=l;return c.wasmtonkcore_connectWebsocket(this.__wbg_ptr,e,r)}createFileWithBytes(t,e,r){const o=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),i=l,s=Z(r,c.__wbindgen_malloc),a=l;return c.wasmtonkcore_createFileWithBytes(this.__wbg_ptr,o,i,e,s,a)}updateFileWithBytes(t,e,r){const o=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),i=l,s=Z(r,c.__wbindgen_malloc),a=l;return c.wasmtonkcore_updateFileWithBytes(this.__wbg_ptr,o,i,e,s,a)}constructor(){return c.wasmtonkcore_new()}exists(t){const e=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),r=l;return c.wasmtonkcore_exists(this.__wbg_ptr,e,r)}toBytes(t){return c.wasmtonkcore_toBytes(this.__wbg_ptr,t)}readFile(t){const e=f(t,c.__wbindgen_malloc,c.__wbindgen_realloc),r=l;return c.wasmtonkcore_readFile(this.__wbg_ptr,e,r)}}async function Ot(n,t){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,t)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const e=await n.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(n,t);return e instanceof WebAssembly.Instance?{instance:e,module:n}:e}}function it(){const n={};return n.wbg={},n.wbg.__wbg_String_8f0eb39a4a4c2f66=function(t,e){const r=String(e),o=f(r,c.__wbindgen_malloc,c.__wbindgen_realloc),i=l;d().setInt32(t+4*1,i,!0),d().setInt32(t+4*0,o,!0)},n.wbg.__wbg_Window_41559019033ede94=function(t){return t.Window},n.wbg.__wbg_WorkerGlobalScope_d324bffbeaef9f3a=function(t){return t.WorkerGlobalScope},n.wbg.__wbg_abort_99fc644e2c79c9fb=function(){return u(function(t){t.abort()},arguments)},n.wbg.__wbg_bound_f2afc3766d4545cf=function(){return u(function(t,e,r,o){return IDBKeyRange.bound(t,e,r!==0,o!==0)},arguments)},n.wbg.__wbg_buffer_09165b52af8c5237=function(t){return t.buffer},n.wbg.__wbg_buffer_609cc3eee51ed158=function(t){return t.buffer},n.wbg.__wbg_call_672a4d21634d4a24=function(){return u(function(t,e){return t.call(e)},arguments)},n.wbg.__wbg_call_7cccdd69e0791ae2=function(){return u(function(t,e,r){return t.call(e,r)},arguments)},n.wbg.__wbg_close_2893b7d056a0627d=function(){return u(function(t){t.close()},arguments)},n.wbg.__wbg_commit_a54edce65f3858f2=function(){return u(function(t){t.commit()},arguments)},n.wbg.__wbg_continue_c46c11d3dbe1b030=function(){return u(function(t){t.continue()},arguments)},n.wbg.__wbg_createObjectStore_e566459f7161f82f=function(){return u(function(t,e,r){return t.createObjectStore(m(e,r))},arguments)},n.wbg.__wbg_data_432d9c3df2630942=function(t){return t.data},n.wbg.__wbg_delete_200677093b4cf756=function(){return u(function(t,e){return t.delete(e)},arguments)},n.wbg.__wbg_done_769e5ede4b31c67b=function(t){return t.done},n.wbg.__wbg_entries_3265d4158b33e5dc=function(t){return Object.entries(t)},n.wbg.__wbg_error_31d7961b8e0d3f6c=function(t,e){console.error(m(t,e))},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(t,e){let r,o;try{r=t,o=e,console.error(m(t,e))}finally{c.__wbindgen_free(r,o,1)}},n.wbg.__wbg_error_ff4ddaabdfc5dbb3=function(){return u(function(t){const e=t.error;return p(e)?0:k(e)},arguments)},n.wbg.__wbg_getRandomValues_38a1ff1ea09f6cc7=function(){return u(function(t,e){globalThis.crypto.getRandomValues(Q(t,e))},arguments)},n.wbg.__wbg_getRandomValues_3c9c0d586e575a16=function(){return u(function(t,e){globalThis.crypto.getRandomValues(Q(t,e))},arguments)},n.wbg.__wbg_getTime_46267b1c24877e30=function(t){return t.getTime()},n.wbg.__wbg_get_67b2ba62fc30de12=function(){return u(function(t,e){return Reflect.get(t,e)},arguments)},n.wbg.__wbg_get_8da03f81f6a1111e=function(){return u(function(t,e){return t.get(e)},arguments)},n.wbg.__wbg_get_b9b93047fe3cf45b=function(t,e){return t[e>>>0]},n.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(t,e){return t[e]},n.wbg.__wbg_global_f5c2926e57ba457f=function(t){return t.global},n.wbg.__wbg_indexedDB_54f01430b1e194e8=function(){return u(function(t){const e=t.indexedDB;return p(e)?0:k(e)},arguments)},n.wbg.__wbg_indexedDB_b1f49280282046f8=function(){return u(function(t){const e=t.indexedDB;return p(e)?0:k(e)},arguments)},n.wbg.__wbg_indexedDB_f6b47b0dc333fd2f=function(){return u(function(t){const e=t.indexedDB;return p(e)?0:k(e)},arguments)},n.wbg.__wbg_instanceof_ArrayBuffer_e14585432e3737fc=function(t){let e;try{e=t instanceof ArrayBuffer}catch{e=!1}return e},n.wbg.__wbg_instanceof_CursorSys_4b6a8aba0e823e75=function(t){let e;try{e=t instanceof IDBCursorWithValue}catch{e=!1}return e},n.wbg.__wbg_instanceof_DomException_ed1ccb7aaf39034c=function(t){let e;try{e=t instanceof DOMException}catch{e=!1}return e},n.wbg.__wbg_instanceof_Error_4d54113b22d20306=function(t){let e;try{e=t instanceof Error}catch{e=!1}return e},n.wbg.__wbg_instanceof_IdbCursor_4f02b0cddf69c141=function(t){let e;try{e=t instanceof IDBCursor}catch{e=!1}return e},n.wbg.__wbg_instanceof_IdbDatabase_a3ef009ca00059f9=function(t){let e;try{e=t instanceof IDBDatabase}catch{e=!1}return e},n.wbg.__wbg_instanceof_IdbRequest_4813c3f207666aa4=function(t){let e;try{e=t instanceof IDBRequest}catch{e=!1}return e},n.wbg.__wbg_instanceof_Map_f3469ce2244d2430=function(t){let e;try{e=t instanceof Map}catch{e=!1}return e},n.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9=function(t){let e;try{e=t instanceof Uint8Array}catch{e=!1}return e},n.wbg.__wbg_isArray_a1eab7e0d067391b=function(t){return Array.isArray(t)},n.wbg.__wbg_isSafeInteger_343e2beeeece1bb0=function(t){return Number.isSafeInteger(t)},n.wbg.__wbg_item_c3c26b4103ad5aaf=function(t,e,r){const o=e.item(r>>>0);var i=p(o)?0:f(o,c.__wbindgen_malloc,c.__wbindgen_realloc),s=l;d().setInt32(t+4*1,s,!0),d().setInt32(t+4*0,i,!0)},n.wbg.__wbg_iterator_9a24c88df860dc65=function(){return Symbol.iterator},n.wbg.__wbg_key_29fefecef430db96=function(){return u(function(t){return t.key},arguments)},n.wbg.__wbg_length_a446193dc22c12f8=function(t){return t.length},n.wbg.__wbg_length_e2d2a49132c1b256=function(t){return t.length},n.wbg.__wbg_log_2f4a53bbb94ad21b=function(t,e){console.log(m(t,e))},n.wbg.__wbg_lowerBound_1872d19f5bcf83c6=function(){return u(function(t,e){return IDBKeyRange.lowerBound(t,e!==0)},arguments)},n.wbg.__wbg_message_5c5d919204d42400=function(t,e){const r=e.message,o=f(r,c.__wbindgen_malloc,c.__wbindgen_realloc),i=l;d().setInt32(t+4*1,i,!0),d().setInt32(t+4*0,o,!0)},n.wbg.__wbg_message_97a2af9b89d693a3=function(t){return t.message},n.wbg.__wbg_message_d1685a448ba00178=function(t,e){const r=e.message,o=f(r,c.__wbindgen_malloc,c.__wbindgen_realloc),i=l;d().setInt32(t+4*1,i,!0),d().setInt32(t+4*0,o,!0)},n.wbg.__wbg_name_f2d27098bfd843e7=function(t,e){const r=e.name,o=f(r,c.__wbindgen_malloc,c.__wbindgen_realloc),i=l;d().setInt32(t+4*1,i,!0),d().setInt32(t+4*0,o,!0)},n.wbg.__wbg_new0_f788a2397c7ca929=function(){return new Date},n.wbg.__wbg_new_23a2665fac83c611=function(t,e){try{var r={a:t,b:e},o=(s,a)=>{const b=r.a;r.a=0;try{return Bt(b,r.b,s,a)}finally{r.a=b}};return new Promise(o)}finally{r.a=r.b=0}},n.wbg.__wbg_new_405e22f390576ce2=function(){return new Object},n.wbg.__wbg_new_5e0be73521bc8c17=function(){return new Map},n.wbg.__wbg_new_78feb108b6472713=function(){return new Array},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_new_92c54fc74574ef55=function(){return u(function(t,e){return new WebSocket(m(t,e))},arguments)},n.wbg.__wbg_new_a12002a7f91c75be=function(t){return new Uint8Array(t)},n.wbg.__wbg_new_c68d7209be747379=function(t,e){return new Error(m(t,e))},n.wbg.__wbg_newnoargs_105ed471475aaf50=function(t,e){return new Function(m(t,e))},n.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(t,e,r){return new Uint8Array(t,e>>>0,r>>>0)},n.wbg.__wbg_newwithlength_a381634e90c276d4=function(t){return new Uint8Array(t>>>0)},n.wbg.__wbg_next_25feadfc0913fea9=function(t){return t.next},n.wbg.__wbg_next_6574e1a8a62d1055=function(){return u(function(t){return t.next()},arguments)},n.wbg.__wbg_now_807e54c39636c349=function(){return Date.now()},n.wbg.__wbg_objectStoreNames_9bb1ab04a7012aaf=function(t){return t.objectStoreNames},n.wbg.__wbg_objectStore_21878d46d25b64b6=function(){return u(function(t,e,r){return t.objectStore(m(e,r))},arguments)},n.wbg.__wbg_openCursor_238e247d18bde2cd=function(){return u(function(t){return t.openCursor()},arguments)},n.wbg.__wbg_open_e0c0b2993eb596e1=function(){return u(function(t,e,r,o){return t.open(m(e,r),o>>>0)},arguments)},n.wbg.__wbg_push_737cfc8c1432c2c6=function(t,e){return t.push(e)},n.wbg.__wbg_put_066faa31a6a88f5b=function(){return u(function(t,e,r){return t.put(e,r)},arguments)},n.wbg.__wbg_queueMicrotask_97d92b4fcc8a61c5=function(t){queueMicrotask(t)},n.wbg.__wbg_queueMicrotask_d3219def82552485=function(t){return t.queueMicrotask},n.wbg.__wbg_readyState_4013cfdf4f22afb0=function(t){const e=t.readyState;return(Wt.indexOf(e)+1||3)-1},n.wbg.__wbg_request_5079471e06223120=function(t){return t.request},n.wbg.__wbg_request_fada8c23b78b3a02=function(t){return t.request},n.wbg.__wbg_resolve_4851785c9c5f573d=function(t){return Promise.resolve(t)},n.wbg.__wbg_result_f29afabdf2c05826=function(){return u(function(t){return t.result},arguments)},n.wbg.__wbg_send_7c4769e24cf1d784=function(){return u(function(t,e){t.send(e)},arguments)},n.wbg.__wbg_set_37837023f3d740e8=function(t,e,r){t[e>>>0]=r},n.wbg.__wbg_set_3f1d0b984ed272ed=function(t,e,r){t[e]=r},n.wbg.__wbg_set_65595bdd868b3009=function(t,e,r){t.set(e,r>>>0)},n.wbg.__wbg_set_8fc6bf8a5b1071d1=function(t,e,r){return t.set(e,r)},n.wbg.__wbg_set_bb8cecf6a62b9f46=function(){return u(function(t,e,r){return Reflect.set(t,e,r)},arguments)},n.wbg.__wbg_setbinaryType_92fa1ffd873b327c=function(t,e){t.binaryType=vt[e]},n.wbg.__wbg_setonabort_3bf4db6614fa98e9=function(t,e){t.onabort=e},n.wbg.__wbg_setonclose_14fc475a49d488fc=function(t,e){t.onclose=e},n.wbg.__wbg_setoncomplete_4d19df0dadb7c4d4=function(t,e){t.oncomplete=e},n.wbg.__wbg_setonerror_8639efe354b947cd=function(t,e){t.onerror=e},n.wbg.__wbg_setonerror_b0d9d723b8fddbbb=function(t,e){t.onerror=e},n.wbg.__wbg_setonerror_d7e3056cc6e56085=function(t,e){t.onerror=e},n.wbg.__wbg_setonmessage_6eccab530a8fb4c7=function(t,e){t.onmessage=e},n.wbg.__wbg_setonopen_2da654e1f39745d5=function(t,e){t.onopen=e},n.wbg.__wbg_setonsuccess_afa464ee777a396d=function(t,e){t.onsuccess=e},n.wbg.__wbg_setonupgradeneeded_fcf7ce4f2eb0cb5f=function(t,e){t.onupgradeneeded=e},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(t,e){const r=e.stack,o=f(r,c.__wbindgen_malloc,c.__wbindgen_realloc),i=l;d().setInt32(t+4*1,i,!0),d().setInt32(t+4*0,o,!0)},n.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const t=typeof globalThis>"u"?null:globalThis;return p(t)?0:k(t)},n.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const t=typeof globalThis>"u"?null:globalThis;return p(t)?0:k(t)},n.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const t=typeof self>"u"?null:self;return p(t)?0:k(t)},n.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const t=typeof window>"u"?null:window;return p(t)?0:k(t)},n.wbg.__wbg_target_0a62d9d79a2a1ede=function(t){const e=t.target;return p(e)?0:k(e)},n.wbg.__wbg_then_44b73946d2fb3e7d=function(t,e){return t.then(e)},n.wbg.__wbg_then_48b406749878a531=function(t,e,r){return t.then(e,r)},n.wbg.__wbg_toString_5285597960676b7b=function(t){return t.toString()},n.wbg.__wbg_transaction_7d452475ef3c3c33=function(t){return t.transaction},n.wbg.__wbg_transaction_babc423936946a37=function(){return u(function(t,e,r,o){return t.transaction(m(e,r),At[o])},arguments)},n.wbg.__wbg_upperBound_76a00814e81f6891=function(){return u(function(t,e){return IDBKeyRange.upperBound(t,e!==0)},arguments)},n.wbg.__wbg_value_68c4e9a54bb7fd5e=function(){return u(function(t){return t.value},arguments)},n.wbg.__wbg_value_cd1ffa7b1ab794f1=function(t){return t.value},n.wbg.__wbg_wasmdocumentwatcher_new=function(t){return U.__wrap(t)},n.wbg.__wbg_wasmtonkcore_new=function(t){return N.__wrap(t)},n.wbg.__wbindgen_bigint_from_i64=function(t){return t},n.wbg.__wbindgen_bigint_from_u64=function(t){return BigInt.asUintN(64,t)},n.wbg.__wbindgen_bigint_get_as_i64=function(t,e){const r=e,o=typeof r=="bigint"?r:void 0;d().setBigInt64(t+8*1,p(o)?BigInt(0):o,!0),d().setInt32(t+4*0,!p(o),!0)},n.wbg.__wbindgen_boolean_get=function(t){const e=t;return typeof e=="boolean"?e?1:0:2},n.wbg.__wbindgen_cb_drop=function(t){const e=t.original;return e.cnt--==1?(e.a=0,!0):!1},n.wbg.__wbindgen_closure_wrapper1225=function(t,e,r){return x(t,e,473,V)},n.wbg.__wbindgen_closure_wrapper1227=function(t,e,r){return x(t,e,473,V)},n.wbg.__wbindgen_closure_wrapper1229=function(t,e,r){return x(t,e,473,V)},n.wbg.__wbindgen_closure_wrapper1231=function(t,e,r){return x(t,e,473,It)},n.wbg.__wbindgen_closure_wrapper1829=function(t,e,r){return x(t,e,760,Rt)},n.wbg.__wbindgen_closure_wrapper1831=function(t,e,r){return x(t,e,760,Dt)},n.wbg.__wbindgen_closure_wrapper1891=function(t,e,r){return x(t,e,777,xt)},n.wbg.__wbindgen_debug_string=function(t,e){const r=q(e),o=f(r,c.__wbindgen_malloc,c.__wbindgen_realloc),i=l;d().setInt32(t+4*1,i,!0),d().setInt32(t+4*0,o,!0)},n.wbg.__wbindgen_error_new=function(t,e){return new Error(m(t,e))},n.wbg.__wbindgen_in=function(t,e){return t in e},n.wbg.__wbindgen_init_externref_table=function(){const t=c.__wbindgen_export_4,e=t.grow(4);t.set(0,void 0),t.set(e+0,void 0),t.set(e+1,null),t.set(e+2,!0),t.set(e+3,!1)},n.wbg.__wbindgen_is_bigint=function(t){return typeof t=="bigint"},n.wbg.__wbindgen_is_function=function(t){return typeof t=="function"},n.wbg.__wbindgen_is_null=function(t){return t===null},n.wbg.__wbindgen_is_object=function(t){const e=t;return typeof e=="object"&&e!==null},n.wbg.__wbindgen_is_string=function(t){return typeof t=="string"},n.wbg.__wbindgen_is_undefined=function(t){return t===void 0},n.wbg.__wbindgen_jsval_eq=function(t,e){return t===e},n.wbg.__wbindgen_jsval_loose_eq=function(t,e){return t==e},n.wbg.__wbindgen_memory=function(){return c.memory},n.wbg.__wbindgen_number_get=function(t,e){const r=e,o=typeof r=="number"?r:void 0;d().setFloat64(t+8*1,p(o)?0:o,!0),d().setInt32(t+4*0,!p(o),!0)},n.wbg.__wbindgen_number_new=function(t){return t},n.wbg.__wbindgen_string_get=function(t,e){const r=e,o=typeof r=="string"?r:void 0;var i=p(o)?0:f(o,c.__wbindgen_malloc,c.__wbindgen_realloc),s=l;d().setInt32(t+4*1,s,!0),d().setInt32(t+4*0,i,!0)},n.wbg.__wbindgen_string_new=function(t,e){return m(t,e)},n.wbg.__wbindgen_throw=function(t,e){throw new Error(m(t,e))},n}function st(n,t){return c=n.exports,C.__wbindgen_wasm_module=t,B=null,M=null,c.__wbindgen_start(),c}function Pt(n){if(c!==void 0)return c;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module:n}=n:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const t=it();n instanceof WebAssembly.Module||(n=new WebAssembly.Module(n));const e=new WebAssembly.Instance(n,t);return st(e,n)}async function C(n){if(c!==void 0)return c;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("/assets/tonk_core_bg-fPFOTiu7.wasm",import.meta.url));const t=it();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:e,module:r}=await Ot(await n,t);return st(e,r)}const j=Object.freeze(Object.defineProperty({__proto__:null,WasmBundle:D,WasmDocumentWatcher:U,WasmTonkCore:N,create_bundle_from_bytes:dt,create_tonk:kt,create_tonk_from_bundle:gt,create_tonk_from_bundle_with_storage:mt,create_tonk_from_bytes:Ft,create_tonk_from_bytes_with_storage:yt,create_tonk_with_config:pt,create_tonk_with_peer_id:bt,create_tonk_with_storage:Et,default:C,init:ht,initSync:Pt,set_time_provider:St},Symbol.toStringTag,{value:"Module"}));let rt=!1,P=null;async function Tt(n){if(!rt)return P||(P=(async()=>{try{n?.wasmPath?await C(n.wasmPath):await C(),rt=!0}catch(t){throw P=null,t}})(),P)}console.log("🚀 SERVICE WORKER: Script loaded at",new Date().toISOString());const $t=!0;let R={status:"uninitialized"};function v(){return R.status==="ready"?R:null}function _(n,t,e){const o=`[VFS Service Worker ${new Date().toISOString()}] ${n.toUpperCase()}:`;e!==void 0?console[n](o,t,e):console[n](o,t)}const T=new Map;async function h(n){_("info","Posting response to main thread",{type:n.type,success:"success"in n?n.success:"N/A"}),(await self.clients.matchAll()).forEach(e=>{e.postMessage(n)})}async function Mt(){await Tt({wasmPath:"http://localhost:8081/tonk_core_bg.wasm"});const n=await fetch("http://localhost:8081/.manifest.tonk"),t=new Uint8Array(await n.arrayBuffer()),r=await(await K.fromBytes(t)).getManifest();console.log(r);const o=await E.fromBytes(t);return await o.connectWebsocket("ws://localhost:8081"),{tonk:o,manifest:r}}try{console.log("Before registration");const n=Mt();R={status:"loading",promise:n},n.then(async({tonk:t,manifest:e})=>{R={status:"ready",tonk:t,manifest:e},console.log("Tonk core service worker initialized"),(await self.clients.matchAll()).forEach(o=>{o.postMessage({type:"ready"})})}).catch(async t=>{R={status:"failed",error:t},console.log("tonk error when initialising: ",t),(await self.clients.matchAll()).forEach(r=>{r.postMessage({type:"ready",tonkAvailable:!1})})})}catch(n){console.log("tonk error when initialising: ",n),R={status:"failed",error:n}}self.addEventListener("install",()=>{console.log("🔧 SERVICE WORKER: Installing SW"),self.skipWaiting()});self.addEventListener("activate",async()=>{console.log("🚀 SERVICE WORKER: Activating service worker."),self.clients.claim()});const jt=async(n,t)=>{if(n.bytes){const e=atob(n.bytes),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);return new Response(r,{headers:{"Content-Type":n.content.mime}})}else return new Response(n.content,{headers:{"Content-Type":"application/json"}})},Lt=(n,t)=>{const r=self.location.pathname.split("/").slice(0,-1).join("/")+"/",o=new URL(n).pathname;let i=o.startsWith(r)?o.slice(r.length):o;if(t)try{const a=new URL(t);if(a.origin===n.origin){const b=a.pathname,O=(b.startsWith(r)?b.slice(r.length):b).split("/").slice(0,-1).join("/");O&&i&&!i.startsWith(O+"/")&&(i=O+"/"+i)}}catch(a){console.log("Failed to parse referrer URL:",a)}const s=i.split("/");return console.log(s),s[s.length-1]===""&&(s[s.length-1]="index.html"),s.join("/")};self.addEventListener("fetch",n=>{const t=new URL(n.request.url),e=n.request.referrer;console.log("🌐 SERVICE WORKER FETCH:",t.pathname),console.log("🌐 SERVICE WORKER FULL URL:",t.href),console.log("🌐 SERVICE WORKER REFERRER:",e),t.origin===location.origin&&n.respondWith((async()=>{const r=Lt(t,e);console.log("Fetching Path",r);const o=v();if(!o)throw new Error("Tonk not initialized");console.log(r);try{const s=await o.tonk.readFile(`/app/${r}`);return console.log(s),jt(s,r)}catch(s){_("error","failed to fetch file",s)}const i=await o.tonk.listDirectory("/app");return console.log(i),new Response(`App path "${r}" not found. directories available: ${JSON.stringify(i)}. Make sure the app is properly loaded.`,{status:404,headers:{"Content-Type":"text/plain"}})})())});async function Ct(n){if(_("info","Received message",{type:n.type,id:"id"in n?n.id:"N/A"}),R.status!=="ready"&&n.type!=="init"){_("error","Operation attempted before VFS initialization",{type:n.type,status:R.status}),"id"in n&&h({type:n.type,id:n.id,success:!1,error:"VFS not initialized"});return}switch(n.type){case"readFile":_("info","Reading file",{path:n.path,id:n.id});try{const{tonk:t}=v(),e=await t.readFile(n.path);_("info","File read successfully",{path:n.path,contentType:typeof e,contentConstructor:e?.constructor?.name,isString:typeof e=="string"}),h({type:"readFile",id:n.id,success:!0,data:{content:e.content,bytes:e.bytes}})}catch(t){_("error","Failed to read file",{path:n.path,error:t instanceof Error?t.message:String(t)}),h({type:"readFile",id:n.id,success:!1,error:t instanceof Error?t.message:String(t)})}break;case"writeFile":_("info","Writing file",{path:n.path,id:n.id,create:n.create,contentLength:n.content.length});try{const{tonk:t}=v();n.create?(_("info","Creating new file",{path:n.path}),n.bytes?await t.createFileWithBytes(n.path,JSON.parse(n.content),n.bytes):await t.createFile(n.path,JSON.parse(n.content))):(_("info","Updating existing file",{path:n.path}),await t.updateFile(n.path,JSON.parse(n.content))),_("info","File write completed successfully",{path:n.path}),h({type:"writeFile",id:n.id,success:!0})}catch(t){_("error","Failed to write file",{path:n.path,create:n.create,error:t instanceof Error?t.message:String(t)}),h({type:"writeFile",id:n.id,success:!1,error:t instanceof Error?t.message:String(t)})}break;case"deleteFile":_("info","Deleting file",{path:n.path,id:n.id});try{const{tonk:t}=v();await t.deleteFile(n.path),_("info","File deleted successfully",{path:n.path}),h({type:"deleteFile",id:n.id,success:!0})}catch(t){_("error","Failed to delete file",{path:n.path,error:t instanceof Error?t.message:String(t)}),h({type:"deleteFile",id:n.id,success:!1,error:t instanceof Error?t.message:String(t)})}break;case"listDirectory":_("info","Listing directory",{path:n.path,id:n.id});try{const{tonk:t}=v(),e=await t.listDirectory(n.path);_("info","Directory listed successfully",{path:n.path,fileCount:Array.isArray(e)?e.length:"unknown"}),h({type:"listDirectory",id:n.id,success:!0,data:e})}catch(t){_("error","Failed to list directory",{path:n.path,error:t instanceof Error?t.message:String(t)}),h({type:"listDirectory",id:n.id,success:!1,error:t instanceof Error?t.message:String(t)})}break;case"exists":_("info","Checking file existence",{path:n.path,id:n.id});try{const{tonk:t}=v(),e=await t.exists(n.path);_("info","File existence check completed",{path:n.path,exists:e}),h({type:"exists",id:n.id,success:!0,data:e})}catch(t){_("error","Failed to check file existence",{path:n.path,error:t instanceof Error?t.message:String(t)}),h({type:"exists",id:n.id,success:!1,error:t instanceof Error?t.message:String(t)})}break;case"watchFile":_("info","Starting file watch",{path:n.path,id:n.id});try{const{tonk:t}=v(),e=await t.watchFile(n.path,r=>{_("info","File change detected",{watchId:n.id,path:n.path}),h({type:"fileChanged",watchId:n.id,content:JSON.parse(r.content)})});T.set(n.id,e),_("info","File watch started successfully",{path:n.path,watchId:n.id,totalWatchers:T.size}),h({type:"watchFile",id:n.id,success:!0})}catch(t){_("error","Failed to start file watch",{path:n.path,error:t instanceof Error?t.message:String(t)}),h({type:"watchFile",id:n.id,success:!1,error:t instanceof Error?t.message:String(t)})}break;case"unwatchFile":_("info","Stopping file watch",{watchId:n.id});try{const t=T.get(n.id);t?(_("info","Found watcher, stopping it",{watchId:n.id}),t.stop(),T.delete(n.id),_("info","File watch stopped successfully",{watchId:n.id,remainingWatchers:T.size})):_("warn","No watcher found for ID",{watchId:n.id}),h({type:"unwatchFile",id:n.id,success:!0})}catch(t){_("error","Failed to stop file watch",{watchId:n.id,error:t instanceof Error?t.message:String(t)}),h({type:"unwatchFile",id:n.id,success:!1,error:t instanceof Error?t.message:String(t)})}break}}self.addEventListener("message",async n=>{try{await Ct(n.data)}catch(t){_("error","Error handling message",{error:t instanceof Error?t.message:String(t)})}});_("info","VFS Service Worker started",{debugLogging:$t});
